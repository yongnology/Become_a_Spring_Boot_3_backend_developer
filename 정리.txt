00장 개발 환경 구축하기

- index.html 파일은
static 폴더에 있어야 인식 가능하다.

======================================

01장 자바 백엔드 개발자가 알아두면 좋은 지식

■ 클라이언트란?
서버로 요청하는 프로그램을 모두 일컬어 말한다.

■ 서버란?
클라이언트의 요청을 받아 처리하는 주체.

■ 데이터베이스란?
여러 사람이 데이터를 한 군데에 모아놓고 여러 사람이 사용할 목적으로 관리한느 데이터 저장소

클라이언트에서 SQL, 즉 데이터베이스를 조작하기 위한 언어로 데이터베이스 관리 시스템에
데이터를 요청하면 데이터베이스 관리 시스템은 데이터베이스에서 데이터를 꺼내 응답한다.

■ RDB란?
- Relational Database의 약자. 관계형 데이터베이스 라는 뜻.
- NoSQL 또는 NewSQL로 구분한다.
- 관계형 데이터베이스는 데이터를 행row 과 열column로 이루어진 테이블로 관리하며
  기본키(primary key)를 사용해 각 행을 식별 한다.

■ SQL이란?
Structured Query Language의 약자로 말그대로 쿼리. 즉 데이터 검색을 하는 언어

■ NoSQL이란?
- SQL을 안쓴다는 의미로 사용되기도 하지만, 최근에는 Not Only SQL의 의미로 많이 사용한다.
- 예시로, 다이나모디비, 카우치베이스, 몽고디비 와 같은 NoSQL 데이터베이스들이 있다.

■ 라이브러리란?
애플리케이션 개발에 필요한 기능인 클래스, 함수 등을 모아놓은 코드의 모음

■ 프레임워크란?
소프트웨어 개발을 수월하게 하기 위한 소프트웨어 개발 환경

프레임워크는 애플리케이션을 개발할 때 전체적인 구조를 잡기 위해 사용는것이며
라이브러리는 개발을 하는 과정에서 필요한 기능을 구현하기 위해 사용하는 것

■ 백엔드 개발자의 업무
과제할당 -> 과제분석 -> 개발 -> 테스트(리뷰)
-> QA 및 버그 수정-> 배포 -> 유지보수

======================================

02장 스프링 부트 3 시작하기
2.1 스프링과 스프링부트

■ 스프링과 스프링부트
2003년 6월 스프링 프레임워크가 등장.
2013년 4월 0.5.0.M6 버전 첫 스프링 부트 출시

2.2 스프링 콘셉트 공부하기

■ 스프링 부트의 주요 특징
- 톰켓, 제티, 언더토우 같은 웹 애플리케이션 서버(WAS)가 내장되어 있어서 따로 설치하지 않아도 독립적 실행 가능
- 빌드 구성을 단순화하는 스프링 부트 스타터를 제공
- XML 설정을 하지 않고 자바 코드로 모두 작성 가능
- JAR를 이용해서 자바 옵션만으로도 배포가 가능
- 애플리케이션의 모니터링 및 관리 도구인 스프링 액츄에이터(spring actuator)을 제공

■ IoC란?
Inversion of Control을 줄인 표현. 직역하면 제어의 역전.

■ Di란?
스프링에서는 객체들을 관리하기 위해 제어의 역전을 사용한다.
제어의 역전을 구현하기 위해 사용하는 방법이 DI이다.
Dependency Injection의 줄인말. 직역하면 의존성 주입.

DI란 어떤 클래스가 다른 클레스에 의존한다는 뜻.
예) @Autowired 애너테이션은 스프링 컨테이너에 있는 빈이라는 것을 주입하는 역할
빈은 쉽게 말해 스플이 컨테이너에서 관리하는 객체를 말한다.

예제)
public class A {
  // A에서 B를 주입받음
  @Autowired
  B b;
}

스프링의 경우 클래스 A에서 B객체를 쓰고 싶은 경우
객체를 직접 생성하는 것이 아니라 스프링 컨테이너에서 객체를 주입받아 사용한다.
스프링의 핵심 개념.

■ 스프링 컨테이너란?
스프링 컨테이너는 빈을 생성하고 관리한다.
즉 빈이 생성되고 소멸되기까지의 생명주기를 이 스프링 컨테이너가 관리하는 것이다.

■ 빈이란?
스프링 컨테이너가 생성하고 관리하는 객체.
위의 B가 빈이다.

클래스를 빈으로 등학하는 방법 예시)
@Component  // 클래스 MyBean 빈으로 등록
public class MyBean {
}

간단하게 정리하면, [스프링에서 제공해주는 객체]

■ AOP란?
Aspect Oriented Programming 의 줄인말. 직역하면 관점 지향 프로그래밍
프로그래밍에 대한 관심을 핵심 관점, 부가 관점으로 나누어서 관심 기준으로 모듈화하는 것을 의미.

■ 이식 가능한 서비스 추상화란?
PSA( Portable Service Abstraction)의 예제로는
클라리언트의 매핑과 클래스, 메서드의 매핑을 위한 애너테이션이 있다.

스프링에서 데이터베이스에 접근하기 위한 기술로 JPA, MyBatis, JDBC
여기에서 어떤 기술을 사용하든 일관된 방식으로 데이터베이스에 접근하도록 인터페이스를 지원한다.

WAS 도 PSA의 예시중 하나
코드는 그대로 두고 WAS를 톰캣이 아닌 언더토우, 네티와 같은 다른 곳에서 실행해도 기존 코드를 그대로 사용가능.

2.3 스프링 부트3 둘러보기

■ 스프링 공식 문서
스프링 공식 Dependency Version 문서
bit.ly/3N0vENa

스프링 종류 참고(깃허브)
bit.ly/40o8bZd

■ 자동구성
스프링 부트는 서버를 시작할 때 구성 파일을 읽어와서 설정한다. 이를 자동 설정이라 한다.
자동 설정은 META-INF에 있는 spring.factories 파일에 담겨 있다.

■ 스프링 부트3에서 변경되는 내용
- 패키지 네임스페이스가 javax.*에서 jakarta.*로 변경
- GraalVM 네이티브 이미지를 공식 지원
 : JVM 실행 파일과 비교해 네이티브 이미지를 사용하면 가동 시간이 짧아지고 메모리를 더 적게 소모한다.

2.4 스프링 부트 3코드 이해하기

@springBootConfiguration
스프링부트 관련 설정을 나타내는 애너테이션
: @Configuration을 상속해서 만든 애너테이션

@ComponentScan
사용자가 등록한 빈을 읽고 등록하는 애너테이션
: @Component라는 애너테이션을 가진 클래스들을 찾아 빈으로 등록하는 역할.
  - @Configuration : 설정 파일 등록
  - @Repository  : ORM 매핑
  - @Controller, @RestController : 라우터
  - @Service : 비즈니스 로직

@EnableAutoConfiguration
스프링 부트에서 자동 구성을 활성화하는 애너테이

■ 핵심 요약
1. 스프링은 앤터프라이즈 애플리켕션을 쉽게 개발할 수 있도록 도와주는 프레임워크이다.
2. IoC는 제어의 역전, DI는 의존성 주입을 뜻한다.
3. 스프링부트는 스프링을 더 빠르고 쉽게 사용하기 위한 도구로서 스타터와 자동 구성을 제공한다.
4. 애너테이션은 자바 소스 코드에 추가하는 표식. 보통 @기호를 앞에 붙여서 사용하며,
   JDK 1.5 버전부터 사용할 수 있다. 
  애너테이션은 메타 데이터(데이터에 대한 설명을 담고 있는 데이터)의 비중이 가장 크다.
5. @SpringBootApplication은 스프링 부트 관련된 설정을 하는 @SpringBootConfiguration
  , 사용자가 등록한 빈을 읽고 등록하는 @ComponentScan,
  , 자동 설정으로 등록되는 빈을 읽고 등록하는 @EnableAutoConfiguration으로 이루어져 있다.
6. @Component 애너테이션이 있는 클래스는 빈으로 등록되며
  @Controller, @RestController, @Configuration, @Repository, @Service 
  모두
  @Component 애너테이션을 가지고 있다. 
  때에 따라 알맞은 애너테이션을 선택해야 한다.

======================================

03장 스프링 부트3 구조 이해하기
3.1 스프링 부트 3구조 살펴보기

컨트롤러 : 프레젠테이션 계층
서비스  : 비즈니스 계층
리포지토리  : 퍼시스턴스 계층
                : 데이터베이

■ 프레젠테이션 계층
HTTP 요청을 받고 이 요청을 비즈니스 계층을 ㅗ전송하는 역할
컨트롤러가 바로 프레젠테이션 계층 역할

■ 비즈니스 계층
모든 비즈니스 로직을 처리
비즈니스 로직이란, 서비스를 만들기 위한 로직
서비스가 비즈니스 계층의 역할

■ 퍼시스턴스 계층
모든 데이터베이스 관련 로직을 처리
데이터베이스에 접근하는 DAO 객체를 사용할 수도 있다.
DAO는 데이터베이스 계층과 상호작용하기 위한 객체.
리포지터리가 피시스턴스 계층의 역할

■ 코드비교 ■ ■ ■ ■ ■ ■ 
https://www.diffchecker.com/
■ ■ ■ ■ ■ ■ ■ ■ ■ ■ ■ 

3.3 스프링 부트 요청-응답 과정 한 방에 이해하기

■ 핵심 요약
일반적으로 스프링 부트 프로젝트는 3개 개층으로 이루어진다.

1. 프레젠테이션 계층은 HTTP 요청을 받고 비즈니스 계층으로 전송한다.
2. 비즈니스 곛ㅇ은 모든 비즈니스 로직을 처리한다. 퍼시스턴스 계층에서 제공하는 서비스를 사용할 수도 있고,
  권한을 부여하거나 유효성 검사를 하기도 한다.
3. 퍼시스턴스 계층은 모든 스토리지 관련 로직을 처리한다.
  이 과정에서 데이터베이스에 접근하기 위한 객체인 DAO를 사용할 수 도 있다.

======================================

04장 스프링 부트3와 테스트
4.1 테스트 코드 개념 익히기

■ given-when-then 패턴
테스트 코드를 세 단계로 구분해 작성하는 방식
1. given: 테스트 실행을 준비하는 단계
2. when: 테스트를 진행하는 단계
3. then: 테스트 결과를 검증하는 단계

■ JUnit이란?
자바 언어를 위한 단위 테스트 프레임워크

□ JUnit의 특징
- 테스트 방식을 구분할 수 있는 애너테이션을 제공
- @Test 애너테이션으로 메서드를 호출할 때마다 새 인스턴스를 새성, 독립 테스트 가능
- 예상 결과를 검증하는 어설션 메서드 제공
- 사용 방법이 단순, 테스트 코드 작성 시간이 적음
- 자동 실행, 자체 결과를 확인하고 즉각적인 피드백을 제공

■ JUnitCycleTest.java 에서

@BeforeAll 애너테이션
전체 테스트를 시작하기 전에 처음으로 한 번만 실행.
데이터베이스를 연결해야하거나 테스트 환경을 초기화 할 때 사용
static으로 선언해야 한다.

@BeforeEach 애너테이션
테스트 케이스를 시작하기 전에 매번 실행
테스트 메서드에서 사용하는 객체를 초기화하거나 테스트에 필요한 값을 미리 넣을 때 사용
각 인스턴스에 대해 메서드를 호출해야 하므로 메서드는 static이 아니어야 한다.

@AfterAll 애너테이션
전체 테스트를 마치고 종료하기 전에 한 번만 실행
데이터베이스 연결을 종료할 때나 공통적으로 사용하는 자원을 해제할 때 사용
전체 테스트 실행 주기에서 한 번만 호출되어야 하므로 메서드를 static으로 선언

@AfterEach 애너테이션
각 테스트 케이스를 종료하기 전 매번 실행
테스트 이후에 특정 데이터를 삭제해야 하는 경우 사용
static이 아니어야 한다.

■ AssertJ로 검증문 가독성 높이기
isEqualTo(A): A값과 같은지 검증
isNotEqualTo(A): A값과 다른지 검증
contains(A): A값을 포함하는지 검증
doesNotContain(A): A값을 포함하지 않는지 검증
startsWith(A): 접두사가 A인지 검증
endsWith(A): 접미사가 A인지 검증
isEmpty(): 비어 있는 값인지 검증
isNotEmpty(): 비어 있지 않은 값인지 검증
isPositive(): 양수인지 검증
isNegative(): 음수인지 검증
isGreaterThan(1): 1보다 큰 값인지 검증
isLessThan(1): 1보다 작은 값인지 검증

4.3 제대로 테스트 코드 작성해보기

@SpringBootTest
메인 애플리케이션 클래스에 추가하는 애너테이션인 @SpringBootApplication이 있는 클래스를 찾고
그 클래스에 포함되어 있는 빈을 찾은 다음 테스트용 애플리케이션 컨텍스트라는 것을 만든다.

@AutoConfigureMockMvc
MockMvc를 생성하고 자동으로 구성하는 애너테이션
MockMvc는 애플리케이션을 서버에 배포하지 않고도 테스트용 MVC 환경을 만들어 요청 및 전송, 응답 기능을 제공하는 유틸리티 클래스.
즉 컨트롤러를 테스트할 때 사용되는 클래스

@BeforeEach
테스트를 실행하기 전에 실행하는 메서드에 적용하는 애너테이션.

@AfterEach
테스트를 실행한 이후에 실행하는 메서드에 적용하는 애너테이션

■ 테스트 코드 패턴 연습하기

QuizController.java 에서
quiz 패스로 GET 요청시

code: 1 => 응답코드 201 => 본문 Created!
code: 2 => 응답코드 400 => 본문 Bad Request!
그외     => 응답코드 200 => 본문 OK!

■ 핵심 요약
1. 테스트 코드를 작성하면 코드의 기능이 제대로 작동한다는 것을 검증할 수 있다.
테스트 코드는 보통 테스트를 준비하는 given, 테스트를 실제로 진행하는 when, 테스트 결과를 검증하는 then으로 구분된다.

2. JUnit은 단위 테스트를 할 때 사용하는 자바 테스트 프레임워크이다.
@BeforeAll 에너테이션으로 설정한 메서드가 실행되고,
그 이후에는 테스트 케이스 개수만큼 @BeforEach -> @Test ->@AfterEach의 생명 주기를 가지고 실행한다.
모든 테스트가 완료되면 마지막으로 @AfterAll 애너테이션으로 설정한 메서드가 실행되고 종료된다.

3. AssertJ는 Junit과 함께 사용해 검증문의 가독성을 확 높여주는 라이버리이다.


======================================

05장 데이터베이스 조작이 편해지는 ORM
5.1 데이터베이스란?

■ DBMS(DataBase Management System)
데이터베이스를 관리하기 위한 소프트웨어

■ 관계형 DBMS
EX) H2
자바로 작성되어 있는 RDBMS - 스프링 부트가 지원하는 인메모리 관계형 데이터베이스

5.2 ORM이란?
■ ORM
Object Relational Mapping, 자바의 객체와 데이터베이스를 연결하는 프로그래밍 기법

■ ORM 장점
1. SQL을 직접 작성하지 않고 사용하는 언어로 데이터베이스에 접근할 수 있다.
2. 객체지향적으로 코드를 작성할 수 있기 때문에 비즈니스 로직에만 집중할 수 있다.
3. 데이터베이스 시스템이 추상화되어 있기 떄문에 MYSQL에서 PostgramSQL로 전환한다고 해도
  추가로 드는 작업이 거의 없다. 즉 데이터베이스 시스템에 대한 종속성이 줄어든다.
4. 매핑하는 정보가 명확하기 때문에 ERD에 대한 의존도를 낮출 수 있고, 유지보수할 때 유리

■ ORM 단점
1. 프로젝트의 복잡성이 커질수록 사용 난이도도 올라간다.
2. 복잡하고 무거운 쿼리는 ORM으로 해결이 불가능한 경우가 있다.

5.3 JPA와 하이버네이트?

■ JPA(Java Persistence API)
: 자바 객체와 데이터베이스를 연결해 데이터를 관리.
객체 지향 도메인 모델과 데이터베이스의 다리 역할을 한다.
자바에서는 JPA(java persitence API)를 표준으로 사용한다.

■ 하이버네이트
: JPA의 인터페이스를 구현한다.
내부적으로 JDBC API를 사용한다.

■ 엔티티(Entity)
데이터베이스의 테이블과 매핑되는 객체를 의미.
데이터베이스의 테이블과 직접 연결된다는 특징.
데이터베의스에 영향을 미치는 쿼리를 실행하는 객체.

■ 엔티티 매니저
엔티티를 관리해 데이터베이스와 애플리케이션 사이에서 객체를 생성, 수정, 삭제하는 등의 역할
이런 엔티티 매니저를 만드는 곳이 엔티티 매니저 팩토리

■ 영속성 컨텍스트란?
엔티티 매니저는 엔티티를 영속성 컨텍스트에 저장한다는 특징.
영속성 컨텍스트는 JPA의 중요한 특징 중 하나로, 엔티티를 관리하는 가상의 공간.

□ 특징
1. 1차 캐시 
1차 캐시를 가지고 있다.
캐시의 키는 엔티티의 @Id 애너테이션이 달린 기본키 역할을 하는 식별자이며 값은 엔티티.

2. 쓰기 지연
트랜잭션을 커밋하기 전까지는 데이터베이스에 실제로 질의문을 보내지 않고
쿼리를 모았다가 트랜잭션을 커밋하면 쿼리를 한번에 실행하는 것을 의미.

3. 변경 감지
트랜잭션을 커밋하면 1차 캐시에 저장되어 있는 엔티티의 값과 현재 엔티티의 값을 비교해서 변경된 값이 있다면
변경 사항을 감지해 변경된 값을 데이터베이스에 자동으로 반영한다.

4. 지연 로딩
쿼리로 요청한 데이터를 애플리케이션에 바로 로딩하는 것이 아니라 필요할 때 쿼리를 날려 데이터를 조회하는 것.

■ 엔티티의 상태
- 분리 상태 : 영속성 컨텍스트가 관리하고 있지 않는 상태
- 관리 상태 : 영속성 컨텍스트가 관리하는 상태
- 비영속 상태 : 영속성 컨텍스트와 전혀 관계가 없는 상태
- 삭제된 상태

5.4 스프링 데이터와 스프링 데이터 JPA

■ 쿼리 메서드
- 전체 조회 : findAll()
- 아이디로 조회: findById()
- 특정 컬럼으로 조회 : 쿼리 메서드 명명규칙에 맞게 정의 후 사용

- 한꺼번에 여러 레코드 추가 : saveAll()
- 아이디로 레코드 삭제 : deleteById()
- 모든 레코드 삭제 : deleteAll()

5.5 예제 코드 살펴보기

■ 핵심 요약
1. ORM 은 객체와 데이터베이스를 연결하는 프로그래밍 기법
2. JPA는 자바에서 관계형 데이터베이스를 사용하는 방식을 정의한 인터페이스
3. 하이버네이트는 JPA의 대표적인 구현체로, 자바 언어를 위한 ORM 프레임워크
4. 스프링 데이터 JPA는 JPA를 쓰기 편하게 만들어놓은 모듈


======================================